datasets:
  articles:
    type: file
    path: experiments/skeleton/blackvault_articles_trunc.json

default_model: gemini/gemini-2.0-flash
default_bypass_cache: true
optimizer_config:
  judge_agent_model: azure/gpt-4o-mini
  rewrite_agent_model: claude-3-7-sonnet-20250219
  sample_sizes:
    resolve: 50
  model_choices:
    - gemini/gemini-2.0-flash
    - gemini/gemini-2.0-flash-lite-preview-02-05
    - gemini/gemini-2.5-flash-preview-04-17
    # - gemini/gemini-2.5-pro-preview-03-25
  save_all_plans: true
  debug: true
  scoring_func: "lambda x: (1 if len(x.get('summary', '')) > 5 else 0) + (1 if 'location' in x.get('summary', '') else 0) + (1 if 'witness' in x.get('summary', '') else 0)"
  plot_results: true

operations:
  - type: sample
    method: uniform
    random_state: 42
    samples: 50
    name: sample_articles
  - name: generate_summary
    type: map
    optimize: true
    prompt: |
      Given the following document content from the black vault, generate a concise summary that includes:
      1. All unique real-world locations mentioned (cities, states, countries, military bases, etc.).
      2. Descriptions of any witness accounts or testimonies.
      3. Other key events, observations, or details reported in the document.

      Document Content:
      {{ input.all_content }}

      Provide the summary as a single block of text.
    output:
      schema:
        summary: str

  

pipeline:
  steps:
    - name: analyze_events
      input: articles
      operations:
        - sample_articles
        - generate_summary

  output:
    type: file
    path: experiments/skeleton/map_summary_test.json
    intermediate_dir: experiments/skeleton/intermediate_summary
