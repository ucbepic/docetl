
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../split/">
      
      
        <link rel="next" href="../unnest/">
      
      
      <link rel="icon" href="../../assets/docetl-favicon-color.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Gather - docetl docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"Source Code Pro"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="#FDB515">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gather-operation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="docetl docs" class="md-header__button md-logo" aria-label="docetl docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M0 112c0-41.5 31.6-75.6 72-79.6V32h280c53 0 96 43 96 96v176H272c-39.8 0-72 32.2-72 72v60c0 24.3-19.7 44-44 44s-44-19.7-44-44V208H48c-26.5 0-48-21.5-48-48zm236.8 368c7.1-13.1 11.2-28.1 11.2-44v-60c0-13.3 10.7-24 24-24h248c13.3 0 24 10.7 24 24v24c0 44.2-35.8 80-80 80zM80 80c-17.7 0-32 14.3-32 32v48h64v-48c0-17.7-14.3-32-32-32"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            docetl docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Gather
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="#FDB515"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="#FDB515"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="#FDB515"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ucbepic/docetl" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    ucbepic/docetl
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../concepts/operators/" class="md-tabs__link">
          
  
  
    
  
  User Guide

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../optimization/overview/" class="md-tabs__link">
          
  
  
    
  
  Optimization

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/presidential-debate-themes/" class="md-tabs__link">
          
  
  
    
  
  Tutorials & Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/custom-parsing/" class="md-tabs__link">
          
  
  
    
  
  Developer Reference

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../playground/" class="md-tabs__link">
          
  
  
    
  
  Tools & Resources

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="docetl docs" class="md-nav__button md-logo" aria-label="docetl docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M0 112c0-41.5 31.6-75.6 72-79.6V32h280c53 0 96 43 96 96v176H272c-39.8 0-72 32.2-72 72v60c0 24.3-19.7 44-44 44s-44-19.7-44-44V208H48c-26.5 0-48-21.5-48-48zm236.8 368c7.1-13.1 11.2-28.1 11.2-44v-60c0-13.3 10.7-24 24-24h248c13.3 0 24 10.7 24 24v24c0 44.2-35.8 80-80 80zM80 80c-17.7 0-32 14.3-32 32v48h64v-48c0-17.7-14.3-32-32-32"/></svg>

    </a>
    docetl docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ucbepic/docetl" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    ucbepic/docetl
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../.." class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Core Concepts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Core Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/operators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Operators & Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/schemas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Output Schemas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/pipelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pipelines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/optimization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Retrieval
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Retrieval
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../retrievers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Retrievers
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    LLM-Powered Operators
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            LLM-Powered Operators
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Map
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resolve/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Resolve
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reduce/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reduce
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../parallel-map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parallel Map
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../filter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Filter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../equijoin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Equijoin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rank/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rank
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../extract/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extract
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cluster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cluster
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" checked>
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Auxiliary Operators
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Auxiliary Operators
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../split/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Split
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Gather
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Gather
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    <span class="md-ellipsis">
      Motivation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-gather-works" class="md-nav__link">
    <span class="md-ellipsis">
      How Gather Works
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How Gather Works">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#peripheral-context" class="md-nav__link">
    <span class="md-ellipsis">
      Peripheral Context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#document-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Document Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-enhancing-context-in-legal-document-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸš€ Example: Enhancing Context in Legal Document Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸš€ Example: Enhancing Context in Legal Document Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-extract-metadata-map-operation-before-splitting" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Extract Metadata (Map operation before splitting)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-split-operation" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Split Operation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-extract-headers-map-operation" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Extract Headers (Map operation)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-gather-operation" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Gather Operation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-analyze-chunks-map-operation-after-gather" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Analyze Chunks (Map operation after Gather)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#peripheral-chunks-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Peripheral Chunks Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Peripheral Chunks Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure" class="md-nav__link">
    <span class="md-ellipsis">
      Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Example Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#behavior-details" class="md-nav__link">
    <span class="md-ellipsis">
      Behavior Details
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output" class="md-nav__link">
    <span class="md-ellipsis">
      Output
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-document-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Handling Document Structure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Handling Document Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-header-handling-works" class="md-nav__link">
    <span class="md-ellipsis">
      How Header Handling Works
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-header-handling-in-legal-contracts" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Header Handling in Legal Contracts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices_1" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../unnest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Unnest
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sample/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sample
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../topk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TopK
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    APIs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            APIs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../python/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Python API Guide
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../pandas/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Pandas Integration
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../optimization/overview/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Optimization
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../examples/presidential-debate-themes/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Tutorials & Examples
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../examples/custom-parsing/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Developer Reference
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../playground/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Tools & Resources
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    <span class="md-ellipsis">
      Motivation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-gather-works" class="md-nav__link">
    <span class="md-ellipsis">
      How Gather Works
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How Gather Works">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#peripheral-context" class="md-nav__link">
    <span class="md-ellipsis">
      Peripheral Context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#document-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Document Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-enhancing-context-in-legal-document-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸš€ Example: Enhancing Context in Legal Document Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸš€ Example: Enhancing Context in Legal Document Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-extract-metadata-map-operation-before-splitting" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Extract Metadata (Map operation before splitting)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-split-operation" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Split Operation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-extract-headers-map-operation" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Extract Headers (Map operation)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-gather-operation" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Gather Operation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-analyze-chunks-map-operation-after-gather" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Analyze Chunks (Map operation after Gather)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#peripheral-chunks-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Peripheral Chunks Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Peripheral Chunks Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure" class="md-nav__link">
    <span class="md-ellipsis">
      Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Example Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#behavior-details" class="md-nav__link">
    <span class="md-ellipsis">
      Behavior Details
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output" class="md-nav__link">
    <span class="md-ellipsis">
      Output
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-document-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Handling Document Structure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Handling Document Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-header-handling-works" class="md-nav__link">
    <span class="md-ellipsis">
      How Header Handling Works
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-header-handling-in-legal-contracts" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Header Handling in Legal Contracts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices_1" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="gather-operation">Gather Operation</h1>
<p>The Gather operation in DocETL is designed to maintain context when processing divided documents. It complements the Split operation by adding contextual information from surrounding chunks to each segment.</p>
<h2 id="motivation">Motivation</h2>
<p>When splitting long documents, such as complex legal contracts or court transcripts, individual chunks often lack sufficient context for accurate analysis or processing. This can lead to several challenges:</p>
<ul>
<li>Loss of reference information (e.g., terms defined in earlier sections)</li>
<li>Incomplete representation of complex clauses that span multiple chunks</li>
<li>Difficulty in understanding the broader document structure</li>
<li>Missing important context from preambles or introductory sections</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Context Challenge in Legal Documents</p>
<p>Imagine a lengthy merger agreement split into chunks. A single segment might contain clauses referencing "the Company" or "Effective Date" without clearly defining these terms. Without context from previous chunks, it becomes challenging to interpret the legal implications accurately.</p>
</div>
<h2 id="how-gather-works">How Gather Works</h2>
<p>The Gather operation addresses these challenges by:</p>
<ol>
<li>Identifying relevant surrounding chunks (peripheral context)</li>
<li>Adding this context to each chunk</li>
<li>Preserving document structure information</li>
</ol>
<h3 id="peripheral-context">Peripheral Context</h3>
<p>Peripheral context refers to the surrounding text or information that helps provide a more complete understanding of a specific chunk of content. In legal documents, this can include:</p>
<ul>
<li>Preceding text that introduces key terms, parties, or conditions</li>
<li>Following text that elaborates on clauses presented in the current chunk</li>
<li>Document structure information, such as article or section headers</li>
<li>Summarized versions of nearby chunks for efficient context provision</li>
</ul>
<h3 id="document-structure">Document Structure</h3>
<p>The Gather operation can maintain document structure through header hierarchies. This is particularly useful for preserving the overall structure of complex legal documents like contracts, agreements, or regulatory filings.</p>
<h2 id="example-enhancing-context-in-legal-document-analysis">ðŸš€ Example: Enhancing Context in Legal Document Analysis</h2>
<p>Let's walk through an example of using the Gather operation to process a long merger agreement.</p>
<h3 id="step-1-extract-metadata-map-operation-before-splitting">Step 1: Extract Metadata (Map operation before splitting)</h3>
<p>First, we extract important metadata from the full document:</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extract_metadata</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">map</span>
<span class="w">  </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">Extract the following metadata from the merger agreement:</span>
<span class="w">    </span><span class="no">1. Agreement Date</span>
<span class="w">    </span><span class="no">2. Parties involved</span>
<span class="w">    </span><span class="no">3. Total value of the merger (if specified)</span>

<span class="w">    </span><span class="no">Agreement text:</span>
<span class="w">    </span><span class="no">{{ input.agreement_text }}</span>

<span class="w">    </span><span class="no">Return the extracted information in a structured format.</span>
<span class="w">  </span><span class="nt">output</span><span class="p">:</span>
<span class="w">    </span><span class="nt">schema</span><span class="p">:</span>
<span class="w">      </span><span class="nt">agreement_date</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="nt">parties</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">list[string]</span>
<span class="w">      </span><span class="nt">merger_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</code></pre></div>
<h3 id="step-2-split-operation">Step 2: Split Operation</h3>
<p>Next, we split the document into manageable chunks:</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">split_merger_agreement</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">split</span>
<span class="w">  </span><span class="nt">split_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agreement_text</span>
<span class="w">  </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">token_count</span>
<span class="w">  </span><span class="nt">method_kwargs</span><span class="p">:</span>
<span class="w">    </span><span class="nt">num_tokens</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
</code></pre></div>
<h3 id="step-3-extract-headers-map-operation">Step 3: Extract Headers (Map operation)</h3>
<p>We extract headers from each chunk:</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extract_headers</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">map</span>
<span class="w">  </span><span class="nt">input</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agreement_text_chunk</span>
<span class="w">  </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">Extract any section headers from the following merger agreement chunk:</span>
<span class="w">    </span><span class="no">{{ input.agreement_text_chunk }}</span>
<span class="w">    </span><span class="no">Return the headers as a list, preserving their hierarchy.</span>
<span class="w">  </span><span class="nt">output</span><span class="p">:</span>
<span class="w">    </span><span class="nt">schema</span><span class="p">:</span>
<span class="w">      </span><span class="nt">headers</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;list[{header:</span><span class="nv"> </span><span class="s">string,</span><span class="nv"> </span><span class="s">level:</span><span class="nv"> </span><span class="s">integer}]&quot;</span>
</code></pre></div>
<h3 id="step-4-gather-operation">Step 4: Gather Operation</h3>
<p>Now, we apply the Gather operation:</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">context_gatherer</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gather</span>
<span class="w">  </span><span class="nt">content_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agreement_text_chunk</span>
<span class="w">  </span><span class="nt">doc_id_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">split_merger_agreement_id</span>
<span class="w">  </span><span class="nt">order_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">split_merger_agreement_chunk_num</span>
<span class="w">  </span><span class="nt">peripheral_chunks</span><span class="p">:</span>
<span class="w">    </span><span class="nt">previous</span><span class="p">:</span>
<span class="w">      </span><span class="nt">middle</span><span class="p">:</span>
<span class="w">        </span><span class="nt">content_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agreement_text_chunk_summary</span>
<span class="w">      </span><span class="nt">tail</span><span class="p">:</span>
<span class="w">        </span><span class="nt">content_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agreement_text_chunk</span>
<span class="w">    </span><span class="nt">next</span><span class="p">:</span>
<span class="w">      </span><span class="nt">head</span><span class="p">:</span>
<span class="w">        </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">        </span><span class="nt">content_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agreement_text_chunk</span>
<span class="w">  </span><span class="nt">doc_header_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">headers</span>
</code></pre></div>
<h3 id="step-5-analyze-chunks-map-operation-after-gather">Step 5: Analyze Chunks (Map operation after Gather)</h3>
<p>Finally, we analyze each chunk with its gathered context:</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">analyze_chunks</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">map</span>
<span class="w">  </span><span class="nt">input</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agreement_text_chunk_rendered</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agreement_date</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parties</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">merger_value</span>
<span class="w">  </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">Analyze the following chunk of a merger agreement, considering the provided metadata:</span>

<span class="w">    </span><span class="no">Agreement Date: {{ input.agreement_date }}</span>
<span class="w">    </span><span class="no">Parties: {{ input.parties | join(&#39;, &#39;) }}</span>
<span class="w">    </span><span class="no">Merger Value: {{ input.merger_value }}</span>

<span class="w">    </span><span class="no">Chunk content:</span>
<span class="w">    </span><span class="no">{{ input.agreement_text_chunk_rendered }}</span>

<span class="w">    </span><span class="no">Provide a summary of key points and any potential legal implications in this chunk.</span>
<span class="w">  </span><span class="nt">output</span><span class="p">:</span>
<span class="w">    </span><span class="nt">schema</span><span class="p">:</span>
<span class="w">      </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="nt">legal_implications</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">list[string]</span>
</code></pre></div>
<p>This configuration:</p>
<ol>
<li>Extracts important metadata from the full document before splitting</li>
<li>Splits the document into manageable chunks</li>
<li>Extracts headers from each chunk</li>
<li>Gathers context for each chunk, including:</li>
<li>Summaries of the chunks before the previous chunk</li>
<li>The full content of the previous chunk</li>
<li>The full content of the current chunk</li>
<li>The full content of the next chunk</li>
<li>Extracted headers for levels directly above headers in the current chunk, for structural context</li>
<li>Analyzes each chunk with its gathered context and the extracted metadata</li>
</ol>
<h2 id="configuration">Configuration</h2>
<p>The Gather operation includes several key components:</p>
<ul>
<li><code>type</code>: Always set to "gather"</li>
<li><code>doc_id_key</code>: Identifies chunks from the same original document</li>
<li><code>order_key</code>: Specifies the sequence of chunks within a group</li>
<li><code>content_key</code>: Indicates the field containing the chunk content</li>
<li><code>peripheral_chunks</code>: Specifies how to include context from surrounding chunks</li>
<li><code>doc_header_key</code> (optional): Denotes a field representing extracted headers for each chunk</li>
<li><code>sample</code> (optional): Number of samples to use for the operation</li>
</ul>
<h3 id="peripheral-chunks-configuration">Peripheral Chunks Configuration</h3>
<p>The <code>peripheral_chunks</code> configuration in the Gather operation is highly flexible, allowing users to precisely control how context is added to each chunk. This configuration determines which surrounding chunks are included and how they are presented.</p>
<h4 id="structure">Structure</h4>
<p>The <code>peripheral_chunks</code> configuration is divided into two main sections:</p>
<ol>
<li><code>previous</code>: Defines how chunks preceding the current chunk are included.</li>
<li><code>next</code>: Defines how chunks following the current chunk are included.</li>
</ol>
<p>Each of these sections can contain up to three subsections:</p>
<ul>
<li><code>head</code>: The first chunk(s) in the section.</li>
<li><code>middle</code>: Chunks between the <code>head</code> and <code>tail</code> sections.</li>
<li><code>tail</code>: The last chunk(s) in the section.</li>
</ul>
<h4 id="configuration-options">Configuration Options</h4>
<p>For each subsection, you can specify:</p>
<ul>
<li><code>count</code>: The number of chunks to include (for <code>head</code> and <code>tail</code> only).</li>
<li><code>content_key</code>: The key in the chunk data that contains the content to use.</li>
</ul>
<h4 id="example-configuration">Example Configuration</h4>
<div class="highlight"><pre><span></span><code><span class="nt">peripheral_chunks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">previous</span><span class="p">:</span>
<span class="w">    </span><span class="nt">head</span><span class="p">:</span>
<span class="w">      </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">content_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">full_content</span>
<span class="w">    </span><span class="nt">middle</span><span class="p">:</span>
<span class="w">      </span><span class="nt">content_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">summary_content</span>
<span class="w">    </span><span class="nt">tail</span><span class="p">:</span>
<span class="w">      </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">      </span><span class="nt">content_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">full_content</span>
<span class="w">  </span><span class="nt">next</span><span class="p">:</span>
<span class="w">    </span><span class="nt">head</span><span class="p">:</span>
<span class="w">      </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">content_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">full_content</span>
</code></pre></div>
<p>This configuration would:</p>
<ol>
<li>Include the full content of the very first chunk.</li>
<li>Include summaries of all chunks between the <code>head</code> and <code>tail</code> of the previous section.</li>
<li>Include the full content of 2 chunks immediately before the current chunk.</li>
<li>Include the full content of 1 chunk immediately after the current chunk.</li>
</ol>
<h4 id="behavior-details">Behavior Details</h4>
<ol>
<li>
<p><strong>Content Selection</strong>:
   If a <code>content_key</code> is specified that's different from the main content key, it's treated as a summary. This is useful for including condensed versions of chunks in the <code>middle</code> section to save space. If no <code>content_key</code> is specified, it defaults to the main content key of the operation.</p>
</li>
<li>
<p><strong>Chunk Ordering</strong>:
   For the <code>previous</code> section, chunks are processed in reverse order (from the current chunk towards the beginning of the document). For the <code>next</code> section, chunks are processed in forward order.</p>
</li>
<li>
<p><strong>Skipped Content</strong>:
   If there are gaps between included chunks, the operation inserts a note indicating how many characters were skipped. Example: <code>[... 5000 characters skipped ...]</code></p>
</li>
<li>
<p><strong>Chunk Labeling</strong>:
   Each included chunk is labeled with its order number and whether it's a summary. Example: <code>[Chunk 5 (Summary)]</code> or <code>[Chunk 6]</code></p>
</li>
</ol>
<h3 id="best-practices">Best Practices</h3>
<ol>
<li>
<p><strong>Balance Context and Conciseness</strong>: Use full content for immediate context (<code>head</code>) and summaries for <code>middle</code> sections to provide context without overwhelming the main content.</p>
</li>
<li>
<p><strong>Adapt to Document Structure</strong>: Adjust the <code>count</code> for <code>head</code> and <code>tail</code> based on the typical length of your document sections.</p>
</li>
<li>
<p><strong>Use Asymmetric Configurations</strong>: You might want more previous context than next context, or vice versa, depending on your specific use case.</p>
</li>
<li>
<p><strong>Consider Performance</strong>: Including too much context can increase processing time and token usage. Use summaries and selective inclusion to optimize performance.</p>
</li>
</ol>
<p>By leveraging this flexible configuration, you can tailor the Gather operation to provide the most relevant context for your specific document processing needs, balancing completeness with efficiency.</p>
<h2 id="output">Output</h2>
<p>The Gather operation adds a new field to each input document, named by appending "_rendered" to the <code>content_key</code>. This field contains:</p>
<ol>
<li>The reconstructed header hierarchy (if applicable)</li>
<li>Previous context (if any)</li>
<li>The main chunk, clearly marked</li>
<li>Next context (if any)</li>
<li>Indications of skipped content between contexts</li>
</ol>
<div class="admonition example">
<p class="admonition-title">Sample Output for Merger Agreement</p>
<div class="highlight"><pre><span></span><code><span class="nt">agreement_text_chunk_rendered</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">  </span><span class="no">_Current Section:_ # Article 5: Representations and Warranties &gt; ## 5.1 Representations and Warranties of the Company</span>

<span class="w">  </span><span class="no">--- Previous Context ---</span>
<span class="w">  </span><span class="no">[Chunk 17] ... summary of earlier sections on definitions and parties ...</span>
<span class="w">  </span><span class="no">[... 500 characters skipped ...]</span>
<span class="w">  </span><span class="no">[Chunk 18] The Company hereby represents and warrants to Parent and Merger Sub as follows, except as set forth in the Company Disclosure Schedule:</span>
<span class="w">  </span><span class="no">--- End Previous Context ---</span>

<span class="w">  </span><span class="no">--- Begin Main Chunk ---</span>
<span class="w">  </span><span class="no">5.1.1 Organization and Qualification. The Company is duly organized, validly existing, and in good standing under the laws of its jurisdiction of organization and has all requisite corporate power and authority to own, lease, and operate its properties and to carry on its business as it is now being conducted...</span>
<span class="w">  </span><span class="no">--- End Main Chunk ---</span>

<span class="w">  </span><span class="no">--- Next Context ---</span>
<span class="w">  </span><span class="no">[Chunk 20] 5.1.2 Authority Relative to This Agreement. The Company has all necessary corporate power and authority to execute and deliver this Agreement, to perform its obligations hereunder, and to consummate the Merger...</span>
<span class="w">  </span><span class="no">[... 750 characters skipped ...]</span>
<span class="w">  </span><span class="no">--- End Next Context ---</span>
</code></pre></div>
</div>
<h2 id="handling-document-structure">Handling Document Structure</h2>
<p>A key feature of the Gather operation is its ability to maintain document structure through header hierarchies. This is particularly useful for preserving the overall structure of complex documents like legal contracts, technical manuals, or research papers.</p>
<h3 id="how-header-handling-works">How Header Handling Works</h3>
<ol>
<li>Headers are typically extracted from each chunk using a Map operation after the Split but before the Gather.</li>
<li>The Gather operation uses these extracted headers to reconstruct the relevant header hierarchy for each chunk.</li>
<li>When rendering a chunk, the operation includes all the most recent headers from higher levels found in previous chunks.</li>
<li>This ensures that each rendered chunk includes a complete "path" of headers leading to its content, preserving the document's overall structure and context.</li>
</ol>
<h3 id="example-header-handling-in-legal-contracts">Example: Header Handling in Legal Contracts</h3>
<p>Let's look at an example of how the Gather operation handles document headers in the context of legal contracts:</p>
<p><a class="glightbox" href="../../assets/headerdiagram.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Example of Document Header Handling in a Gather Operation" src="../../assets/headerdiagram.png" /></a></p>
<p>In this figure:</p>
<ol>
<li>We see two chunks (18 and 20) from a 74-page legal contract.</li>
<li>Each chunk goes through a Map operation to extract headers.</li>
<li>For Chunk 18, a level 1 header "Grant of License" is extracted.</li>
<li>For Chunk 20, a level 3 header "ctDNA Licenses" is extracted.</li>
<li>When rendering Chunk 20, the Gather operation includes:</li>
<li>The level 1 header from Chunk 18 ("Grant of License")</li>
<li>A level 2 header from Chunk 19 (not pictured, but included in the rendered output)</li>
<li>The current level 3 header from Chunk 20 ("ctDNA Licenses")</li>
</ol>
<p>This hierarchical structure provides crucial context for understanding the content of Chunk 20, even though the higher-level headers are not directly present in that chunk.</p>
<div class="admonition note">
<p class="admonition-title">Importance of Header Hierarchy</p>
<p>By maintaining the header hierarchy, the Gather operation ensures that each chunk is placed in its proper context within the overall document structure. This is especially crucial for complex documents where understanding the relationship between different sections is key to accurate analysis or processing.</p>
</div>
<h2 id="best-practices_1">Best Practices</h2>
<ol>
<li>
<p><strong>Extract Metadata Before Splitting</strong>: Run a map operation on the full document before splitting to extract any metadata that could be useful when processing any chunk (e.g., agreement dates, parties involved). Reference this metadata in subsequent map operations after the gather step.</p>
</li>
<li>
<p><strong>Balance Context and Efficiency</strong>: For ultra-long documents, consider using summarized versions of chunks in the "middle" sections to strike a balance between providing context and managing the overall size of the processed data.</p>
</li>
<li>
<p><strong>Preserve Document Structure</strong>: Utilize the <code>doc_header_key</code> parameter to include relevant structural information from the original document, which can be important for understanding the context of complex or structured content.</p>
</li>
<li>
<p><strong>Tailor Context to Your Task</strong>: Adjust the <code>peripheral_chunks</code> configuration based on the specific needs of your analysis. Some tasks may require more preceding context, while others might benefit from more following context.</p>
</li>
<li>
<p><strong>Combine with Other Operations</strong>: The Gather operation is most powerful when used in conjunction with Split, Map (for summarization or header extraction), and subsequent analysis operations to process long documents effectively.</p>
</li>
<li>
<p><strong>Consider Performance</strong>: Be mindful of the increased token count when adding context. Adjust your downstream operations accordingly to handle the larger input sizes, and use summarized context where appropriate to manage token usage.</p>
</li>
<li>
<p><strong>Use <code>next</code> Sparingly</strong>: The <code>next</code> parameter in the Gather operation should be used judiciously. It's primarily beneficial in specific scenarios:</p>
<ul>
<li>When dealing with structured data or tables where the next chunk provides essential context for understanding the current chunk.</li>
<li>In cases where the end of a chunk might cut off a sentence or important piece of information that continues in the next chunk.</li>
</ul>
<p>For most text-based documents, focusing on the <code>prev</code> context is usually sufficient. Overuse of <code>next</code> can lead to unnecessary token consumption and potential redundancy in the gathered output.</p>
<div class="admonition example">
<p class="admonition-title">When to Use <code>next</code></p>
<p>Consider using <code>next</code> when processing:</p>
<pre><code>- Financial reports with multi-page tables
- Technical documents where diagrams span multiple pages
- Legal contracts where clauses might be split across chunk boundaries
</code></pre>
<p>By default, it's recommended to set <code>next=0</code> unless you have a specific need for forward context in your document processing pipeline.</p>
</div>
</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../split/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Split">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Split
              </div>
            </div>
          </a>
        
        
          
          <a href="../unnest/" class="md-footer__link md-footer__link--next" aria-label="Next: Unnest">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Unnest
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.instant.prefetch", "navigation.tracking", "navigation.expand", "navigation.path", "navigation.prune", "navigation.indexes", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "toc.follow", "navigation.footer", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>