{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://rise-forensics.org/schemas/entity.schema.json",
  "title": "RISE Extracted Entity",
  "description": "Entity extracted from evidence (military unit, person, location, organization) with extraction provenance and confidence scoring",
  "type": "object",
  "required": [
    "entity_id",
    "entity_type",
    "extraction_timestamp",
    "extraction_tool",
    "entity_data",
    "extraction_provenance"
  ],
  "properties": {
    "entity_id": {
      "type": "string",
      "pattern": "^ent_(mil|loc|per|org)_[0-9]{3,}$",
      "description": "Unique entity identifier (format: ent_TYPE_###)",
      "examples": ["ent_mil_001", "ent_loc_042", "ent_per_123"]
    },
    "entity_type": {
      "type": "string",
      "enum": ["military_unit", "location", "person", "organization", "weapon", "vehicle"],
      "description": "Type of entity"
    },
    "extraction_timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of extraction"
    },
    "extraction_tool": {
      "type": "string",
      "pattern": "^rise-extract v\\d+\\.\\d+\\.\\d+$",
      "description": "Tool and version that extracted this entity"
    },

    "entity_data": {
      "type": "object",
      "description": "Entity-specific data (structure varies by entity_type)",
      "oneOf": [
        {"$ref": "#/definitions/military_unit_data"},
        {"$ref": "#/definitions/location_data"},
        {"$ref": "#/definitions/person_data"},
        {"$ref": "#/definitions/organization_data"}
      ]
    },

    "extraction_provenance": {
      "type": "object",
      "required": ["source_evidence", "confidence_breakdown"],
      "properties": {
        "source_evidence": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["evidence_id", "extraction_method", "confidence"],
            "properties": {
              "evidence_id": {
                "type": "string",
                "pattern": "^evd_[0-9]{8}_[0-9]{6}_[0-9]{3}$"
              },
              "text_span": {
                "type": "string",
                "description": "Exact text from which entity was extracted"
              },
              "character_offsets": {
                "type": "array",
                "items": {"type": "integer"},
                "minItems": 2,
                "maxItems": 2,
                "description": "[start, end] character offsets in source text"
              },
              "extraction_method": {
                "type": "string",
                "enum": ["ml_ner", "rule_based", "hybrid", "context_database_match", "human_annotated"],
                "description": "Method used for extraction"
              },
              "confidence": {
                "type": "number",
                "minimum": 0.0,
                "maximum": 1.0
              },
              "reasoning": {
                "type": "string",
                "description": "Explanation of extraction decision"
              }
            }
          }
        },

        "context_validation": {
          "type": "object",
          "properties": {
            "matched_database_entry": {
              "type": "boolean",
              "description": "Whether entity matches context database"
            },
            "database_id": {
              "type": "string",
              "description": "ID in context database (if matched)"
            },
            "database_confidence": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0
            },
            "known_aliases_matched": {
              "type": "array",
              "items": {"type": "string"},
              "description": "Which known aliases were matched"
            }
          }
        },

        "confidence_breakdown": {
          "type": "object",
          "required": ["overall_confidence"],
          "properties": {
            "overall_confidence": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Final confidence score (0.0-1.0)"
            },
            "extraction_confidence": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Confidence from extraction method"
            },
            "context_match_confidence": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Confidence from context database match"
            },
            "multi_source_boost": {
              "type": "number",
              "description": "Confidence boost from multiple sources (can be negative)"
            }
          }
        }
      }
    },

    "relationships": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["relationship_type"],
        "properties": {
          "relationship_type": {
            "type": "string",
            "enum": ["command_chain", "subordinate_to", "parent_of", "perpetrator_of", "victim_of", "witness_of", "located_in", "allied_with"]
          },
          "related_entity": {
            "type": "string",
            "description": "Entity ID of related entity"
          },
          "related_event": {
            "type": "string",
            "description": "Event ID of related event"
          },
          "direction": {
            "type": "string",
            "enum": ["subordinate_to", "superior_to", "bidirectional"]
          },
          "confidence": {
            "type": "number",
            "minimum": 0.0,
            "maximum": 1.0
          }
        }
      }
    },

    "quality_flags": {
      "type": "object",
      "properties": {
        "multiple_sources": {
          "type": "boolean",
          "description": "Extracted from multiple sources"
        },
        "context_validated": {
          "type": "boolean",
          "description": "Validated against context database"
        },
        "human_reviewed": {
          "type": "boolean",
          "description": "Reviewed by human expert"
        },
        "ambiguity_noted": {
          "type": "boolean",
          "description": "Ambiguous extraction flagged"
        },
        "requires_verification": {
          "type": "boolean",
          "description": "Needs additional verification"
        }
      }
    }
  },

  "definitions": {
    "military_unit_data": {
      "type": "object",
      "required": ["name_burmese", "name_english"],
      "properties": {
        "name_burmese": {
          "type": "string",
          "description": "Burmese name (exact as extracted)"
        },
        "name_english": {
          "type": "string",
          "description": "English translation/name"
        },
        "full_name": {
          "type": "string"
        },
        "aliases": {
          "type": "array",
          "items": {"type": "string"}
        },
        "unit_type": {
          "type": "string",
          "enum": ["light_infantry_division", "infantry_battalion", "artillery_unit", "air_force_unit", "naval_unit", "special_forces", "police_unit", "border_guard", "unknown"]
        },
        "parent_unit": {
          "type": "object",
          "properties": {
            "entity_id": {"type": "string"},
            "name": {"type": "string"}
          }
        },
        "subordinate_units": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "entity_id": {"type": "string"},
              "name": {"type": "string"}
            }
          }
        },
        "attributes": {
          "type": "object",
          "properties": {
            "commander": {"type": "string"},
            "base_location": {"type": "string"},
            "active_period": {"type": "string"}
          }
        }
      }
    },

    "location_data": {
      "type": "object",
      "required": ["name_english"],
      "properties": {
        "name_burmese": {"type": "string"},
        "name_english": {"type": "string"},
        "location_type": {
          "type": "string",
          "enum": ["village", "township", "region", "city", "military_base", "landmark", "other"]
        },
        "township": {"type": "string"},
        "region": {"type": "string"},
        "coordinates": {
          "type": "object",
          "properties": {
            "lat": {"type": "number", "minimum": -90, "maximum": 90},
            "lon": {"type": "number", "minimum": -180, "maximum": 180},
            "precision": {
              "type": "string",
              "enum": ["exact", "village", "township", "region", "approximate"]
            }
          }
        },
        "alternative_names": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    },

    "person_data": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": {"type": "string"},
        "name_burmese": {"type": "string"},
        "role": {
          "type": "string",
          "enum": ["civilian", "soldier", "officer", "official", "activist", "witness", "victim", "unknown"]
        },
        "rank": {"type": "string"},
        "unit_affiliation": {"type": "string"},
        "age": {"type": "integer"},
        "gender": {
          "type": "string",
          "enum": ["male", "female", "other", "unknown"]
        },
        "status": {
          "type": "string",
          "enum": ["alive", "injured", "killed", "detained", "missing", "unknown"]
        }
      }
    },

    "organization_data": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": {"type": "string"},
        "name_burmese": {"type": "string"},
        "organization_type": {
          "type": "string",
          "enum": ["government", "military", "resistance", "ngo", "media", "political_party", "ethnic_armed_group", "other"]
        },
        "aliases": {
          "type": "array",
          "items": {"type": "string"}
        },
        "leadership": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    }
  }
}
